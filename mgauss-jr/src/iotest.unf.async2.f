      COMMON /BUFF/ IBUFF(3200,2)
C
C     CBUFF IS BUFFER BEING WRITTEN, NBUFF IS THE BUFFER TO BE FILLED.
C
      DATA CBUFF/2/, NBUFF/1/
C
      OPEN (UNIT=1, BLOCKED=.FALSE., FORM='UNFORMATTED')
C
C     LOOP OVER BUFFERS.
C
      DO 500 I=1,500
C
C     INITIALIZE THE ARRAY.
C
      DO 100 J=1,3200
  100 IBUFF(J,NBUFF) = I + J
C
C     WRITE OUT THE ARRAY - WAIT FOR THE PREVIOUS I/O TO COMPLETE.
C
      IF (I .EQ. 1) GO TO 400
C
      CALL M:WAIT (1)
  210 CALL STATUS (1, ISTAT, NBYTES)
      GO TO (210,300,900,910), ISTAT
C
  300 IF (NBYTES .NE. 12800) THEN
         WRITE (6,310) NBYTES, I
  310    FORMAT ('0*** NBYTES =',I6,' FOR I =',I5/)
         STOP
      END IF
C
  400 CALL BUFFEROUT (1, 1, IBUFF(1,NBUFF), 3200)
      CBUFF = NBUFF
      NBUFF = 3 - CBUFF
  500 CONTINUE
C
C     WAIT FOR THE LAST BUFFER TO BE WRITTEN OUT.
C
      CALL M:WAIT (1)
  510 CALL STATUS (1, ISTAT, NBYTES)
      GO TO (510,600,900,910), ISTAT
C
  600 IF (NBYTES .NE. 12800) THEN
         WRITE (6,610) NBYTES
  610    FORMAT ('0*** NBYTES =',I6,' FOR LAST BUFFER'/)
         STOP
      END IF
      ENDFILE 1
      STOP
C
  900 STOP 900
  910 STOP 910
      END
